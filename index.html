<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CSV Dataset Explorer</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      line-height: 1.6;
      color: #333;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 2rem;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      overflow: hidden;
    }

    header {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 3rem 2rem;
      text-align: center;
    }

    header h1 {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    header p {
      font-size: 1.2rem;
      opacity: 0.95;
    }

    main {
      padding: 3rem 2rem;
    }

    section {
      margin-bottom: 3rem;
    }

    section h2 {
      color: #5048e5;
      margin-bottom: 1rem;
      font-size: 1.5rem;
      border-bottom: 3px solid #5048e5;
      padding-bottom: 0.5rem;
    }

    .quick-start {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin: 2rem 0;
    }

    @media (max-width: 768px) {
      .quick-start {
        grid-template-columns: 1fr;
      }
    }

    .card {
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 1.5rem;
      background: #f9f9f9;
    }

    .card h3 {
      color: #764ba2;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .card p {
      margin-bottom: 1rem;
      color: #666;
    }

    .button-group {
      display: flex;
      gap: 1rem;
      margin-top: 1rem;
    }

    a.btn {
      display: inline-block;
      padding: 0.75rem 1.5rem;
      background: #5048e5;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-weight: 600;
      transition: all 0.3s ease;
      text-align: center;
      flex: 1;
    }

    a.btn:hover {
      background: #764ba2;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(80, 72, 229, 0.4);
    }

    a.btn.secondary {
      background: white;
      color: #5048e5;
      border: 2px solid #5048e5;
    }

    a.btn.secondary:hover {
      background: #f0f0f0;
    }

    .btn-ghost {
      border: none;
      cursor: pointer;
      background: #5048e5;
      color: white;
      border-radius: 6px;
      padding: 0.75rem 1.5rem;
      font-weight: 600;
      font-size: 1rem;
    }

    .btn-ghost.secondary {
      background: #218838;
    }

    .subhead {
      color: #5048e5;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }

    .text-muted { color: #666; }
    .text-accent { color: #5048e5; }
    .text-success { color: #28a745; font-weight: 600; }

    .mt-2 { margin-top: 2rem; }
    .mt-1 { margin-top: 1rem; }
    .mt-075 { margin-top: 0.75rem; }
    .mt-05 { margin-top: 0.5rem; }
    .mb-1 { margin-bottom: 1rem; }
    .small-text { font-size: 0.9rem; }
    .text-center { text-align: center; }
    .large-pill { font-size: 1.2rem; padding: 1rem 2rem; }

    .muted-list {
      margin-left: 1.5rem;
      color: #666;
      margin-bottom: 1rem;
    }

    .compact-list {
      margin-left: 1rem;
      margin-top: 0.5rem;
    }

    .pill-link {
      display: inline-block;
      padding: 0.6rem 1rem;
      background: #5048e5;
      color: white;
      border-radius: 6px;
      text-decoration: none;
      font-weight: 600;
    }

    .accent-link {
      color: #5048e5;
      text-decoration: none;
      font-weight: 600;
    }

    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin: 2rem 0;
    }

    .feature {
      padding: 1.5rem;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      border-radius: 8px;
      text-align: center;
    }

    .feature-icon {
      font-size: 2.5rem;
      margin-bottom: 0.5rem;
    }

    .feature h4 {
      color: #5048e5;
      margin-bottom: 0.5rem;
    }

    .feature p {
      font-size: 0.9rem;
      color: #666;
    }

    .code-block {
      background: #2d2d2d;
      color: #f8f8f2;
      padding: 1.5rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1rem 0;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .code-block code {
      display: block;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .instruction-step {
      margin: 1.5rem 0;
      padding: 1rem;
      background: #f0f4ff;
      border-left: 4px solid #5048e5;
      border-radius: 4px;
    }

    .instruction-step strong {
      color: #5048e5;
    }

    .api-endpoint {
      background: #f9f9f9;
      border-left: 4px solid #764ba2;
      padding: 1rem;
      margin: 1rem 0;
      border-radius: 4px;
      font-family: monospace;
    }

    .api-endpoint .method {
      display: inline-block;
      padding: 0.25rem 0.5rem;
      background: #764ba2;
      color: white;
      border-radius: 3px;
      font-weight: bold;
      margin-right: 0.5rem;
      font-size: 0.85rem;
    }

    .bookmarklet-code {
      background: #f0f0f0;
      border: 1px solid #ccc;
      padding: 1rem;
      border-radius: 6px;
      font-family: monospace;
      word-break: break-all;
      font-size: 0.85rem;
      margin: 1rem 0;
      max-height: 200px;
      overflow-y: auto;
    }

    .warning {
      background: #fff3cd;
      border: 1px solid #ffc107;
      border-radius: 6px;
      padding: 1rem;
      margin: 1rem 0;
      color: #856404;
    }

    .success {
      background: #d4edda;
      border: 1px solid #28a745;
      border-radius: 6px;
      padding: 1rem;
      margin: 1rem 0;
      color: #155724;
    }

    footer {
      background: #f9f9f9;
      padding: 2rem;
      text-align: center;
      color: #666;
      border-top: 1px solid #ddd;
    }

    .use-case {
      background: white;
      border: 1px solid #ddd;
      padding: 1.5rem;
      margin: 1rem 0;
      border-radius: 8px;
    }

    .use-case h4 {
      color: #5048e5;
      margin-bottom: 0.5rem;
    }

    .use-case ol, .use-case ul {
      margin-left: 1.5rem;
      color: #666;
    }

    .use-case li {
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üìä CSV Dataset Explorer</h1>
      <p>Lightweight, accessible data dictionary for government health datasets</p>
    </header>

    <main>
      <!-- Quick Start -->
      <section>
        <h2>üöÄ Quick Start</h2>
        <div class="quick-start">
          <div class="card">
            <h3>Try the Demo</h3>
            <p>Load and explore CSV files with an interactive data dictionary, validation rules, and AI prompts.</p>
            <div class="button-group">
              <a id="demo-link" href="/demo/" class="btn">Open Demo</a>
            </div>
          </div>
          <div class="card">
            <h3>Install Bookmarklet</h3>
            <p>One-click access from healthcare.gov, CDC, and other data portals. Works anywhere with CSV data.</p>
            <div class="button-group">
              <a href="#bookmarklet-installation" class="btn-ghost">View Instructions</a>
            </div>
          </div>
        </div>
      </section>

      <!-- Features -->
      <section>
        <h2>‚ú® Features</h2>
        <div class="features">
          <div class="feature">
            <div class="feature-icon">üìã</div>
            <h3>Auto Schema</h3>
            <p>Infers field types and constraints from data</p>
          </div>
          <div class="feature">
            <div class="feature-icon">üîç</div>
            <h3>Field Search</h3>
            <p>Filter &amp; inspect columns instantly</p>
          </div>
          <div class="feature">
            <div class="feature-icon">‚úÖ</div>
            <h3>Validation Rules</h3>
            <p>Auto-generated constraints per field</p>
          </div>
          <div class="feature">
            <div class="feature-icon">üíæ</div>
            <h3>Local Cache</h3>
            <p>IndexedDB stores data in browser only</p>
          </div>
          <div class="feature">
            <div class="feature-icon">üì§</div>
            <h3>Export</h3>
            <p>Download schema as JSON or CSV</p>
          </div>
          <div class="feature">
            <div class="feature-icon">ü§ñ</div>
            <h3>AI Prompts</h3>
            <p>Copy prompts for LLM analysis</p>
          </div>
          <div class="feature">
            <div class="feature-icon">‚ôø</div>
            <h3>Accessible</h3>
            <p>Keyboard-only, ARIA labels, screen readers</p>
          </div>
          <div class="feature">
            <div class="feature-icon">üè•</div>
            <h3>Healthcare.gov</h3>
            <p>Direct integration via bookmarklet</p>
          </div>
        </div>
      </section>

      <!-- Bookmarklet Setup -->
      <section id="bookmarklet-installation">
        <h2>üîñ Bookmarklet Installation</h2>

        <div class="installation">
          <p><strong>Drag this link to your bookmarks bar:</strong></p>
          <div id="bookmarklet-link"></div>
        </div>

        <h3 class="subhead">Manual Installation</h3>
        <p>If drag-and-drop doesn't work, create a bookmark manually with this code:</p>
        <div id="bookmarklet-code-display"></div>

        <h3 class="subhead">How to Use</h3>
        <p>Navigate to any page with CSV data (healthcare.gov, CDC, CMS, etc.) and click your bookmark. The explorer will automatically find and load CSV files.</p>
      </section>

      <!-- Use Cases -->
      <section>
        <h2>üí° Use Cases</h2>

        <div class="use-case">
          <h3>1. Explore Healthcare.gov Data</h3>
          <p>Find datasets on healthcare.gov, click the bookmark, and instantly see the data dictionary with field definitions, validation rules, and sample values.</p>
          <strong>Example:</strong> <code>https://data.healthcare.gov/dataset/5k5i-wzex</code>
        </div>

        <div class="use-case">
          <h3>2. Quick Schema Review</h3>
          <p>Before loading a CSV into your analysis tool, use the explorer to understand the data structure, field types, and constraints.</p>
        </div>

        <div class="use-case">
          <h3>3. AI-Assisted Analysis</h3>
          <p>Generate pre-written prompts for ChatGPT, Claude, or other LLMs. Copy prompts directly from the explorer to analyze specific fields.</p>
        </div>

        <div class="use-case">
          <h3>4. Data Documentation</h3>
          <p>Export the data dictionary as JSON or CSV headers to include in your project documentation.</p>
        </div>

        <div class="use-case">
          <h3>5. Field-Level Search</h3>
          <p>Search for specific fields across large CSVs. Find all fields matching "patient", "date", "cost", etc.</p>
        </div>
      </section>

      <!-- API Endpoints -->
      <section>
        <h2>üîå API Endpoints (Server)</h2>
        <p>The backend proxy server provides these endpoints for programmatic access:</p>

        <div class="api-endpoint">
          <span class="method">POST</span> <code>/api/proxy/csv</code>
          <p class="text-muted mt-05">Fetch any CSV file with CORS handling. Returns raw CSV data.</p>
          <div class="code-block"><code>curl -X POST http://localhost:3000/api/proxy/csv \
  -H "Content-Type: application/json" \
  -d '{"url":"https://example.com/data.csv"}'</code></div>
        </div>

        <div class="api-endpoint">
          <span class="method">GET</span> <code>/api/healthcare/dataset/:id</code>
          <p class="text-muted mt-05">Extract CSV URLs and metadata from healthcare.gov datasets.</p>
          <div class="code-block"><code>curl http://localhost:3000/api/healthcare/dataset/5k5i-wzex</code></div>
          <p class="text-muted mt-05"><strong>Returns:</strong> JSON with dataset title and CSV URLs</p>
        </div>

        <div class="api-endpoint">
          <span class="method">GET</span> <code>/api/socrata</code>
          <p class="text-muted mt-05">Query Socrata data portals (CDC, CMS, etc.) for dataset metadata.</p>
          <div class="code-block"><code>curl "http://localhost:3000/api/socrata?domain=data.cdc.gov&amp;id=dataset-id"</code></div>
        </div>
      </section>

      <!-- Supported Domains -->
      <section>
        <h2>üåê Supported Data Portals</h2>
        <p>The proxy server handles CORS restrictions for these whitelisted domains:</p>
        <ul class="muted-list">
          <li><strong>healthcare.gov</strong> - Health datasets</li>
          <li><strong>cdc.gov</strong> - Disease and health statistics</li>
          <li><strong>cms.gov</strong> - Medicare/Medicaid data</li>
          <li><strong>healthdata.gov</strong> - Health tracking data</li>
          <li><strong>github.com</strong> - CSV files in public repos</li>
        </ul>
        <div class="warning">
          ‚ö†Ô∏è <strong>Other domains:</strong> Direct browser requests work if CORS allows. Otherwise, add the domain to <code>server.js</code> whitelist.
        </div>
      </section>

      <!-- Architecture -->
      <section>
        <h2>üèóÔ∏è How It Works</h2>
        <div class="code-block"><code>Browser                    Node.js Server (localhost:3000)
‚îú‚îÄ CSV Explorer App        ‚îú‚îÄ Express.js
‚îú‚îÄ IndexedDB Cache         ‚îú‚îÄ CORS Proxy
‚îú‚îÄ Bookmarklet             ‚îú‚îÄ Healthcare.gov extractor
‚îî‚îÄ Vanilla JavaScript      ‚îî‚îÄ Socrata API gateway

User clicks bookmark on healthcare.gov
        ‚Üì
Bookmarklet extracts dataset ID
        ‚Üì
App opens with ?dataset=ID&amp;domain=healthcare.gov
        ‚Üì
Server fetches metadata and CSV URLs
        ‚Üì
Browser parses CSV, infers schema
        ‚Üì
Data cached locally in IndexedDB (browser only)
        ‚Üì
User browses, searches, exports (all local)</code></div>
      </section>

      <!-- Security -->
      <section>
        <h2>üîí Security &amp; Privacy</h2>
        <ul class="muted-list">
          <li>‚úÖ <strong>No data storage</strong> - Server is stateless, doesn't store any data</li>
          <li>‚úÖ <strong>Client-side caching</strong> - Data stays in your browser (IndexedDB)</li>
          <li>‚úÖ <strong>Domain whitelisting</strong> - Only trusted sources allowed through proxy</li>
          <li>‚úÖ <strong>URL validation</strong> - Unsafe URLs rejected before fetching</li>
          <li>‚úÖ <strong>HTTPS ready</strong> - Works with HTTPS in production</li>
        </ul>
      </section>

      <!-- Troubleshooting -->
      <section>
        <h2>‚ùì Troubleshooting</h2>

        <div class="use-case">
          <h3>Bookmarklet not working</h3>
          <p>Ensure the server is running on <code>http://localhost:3000</code> and the bookmarklet code includes the correct <code>PROXY_URL</code>.</p>
        </div>

        <div class="use-case">
          <h3>CSV not loading</h3>
          <p>Check browser console (F12 ‚Üí Console). Common issues:</p>
          <ul class="compact-list">
            <li>Domain not whitelisted (edit <code>server.js</code>)</li>
            <li>URL is a dataset page, not a direct CSV file</li>
            <li>CSV requires authentication</li>
          </ul>
        </div>

        <div class="use-case">
          <h3>Healthcare.gov dataset not detected</h3>
          <p>Run diagnostic in console:</p>
          <div class="code-block"><code>curl http://localhost:3000/api/healthcare/dataset/5k5i-wzex</code></div>
        </div>
      </section>

      <!-- Getting Started -->
      <section>
        <h2>üìö Next Steps</h2>
        <ol class="muted-list">
          <li><strong>Try the demo:</strong> <a href="/demo/" class="accent-link">Open demo</a></li>
          <li><strong>Install bookmarklet:</strong> Copy or drag the bookmark above</li>
          <li><strong>Test with healthcare.gov:</strong> Visit <code>https://data.healthcare.gov/dataset/5k5i-wzex</code> and click the bookmark</li>
          <li><strong>Deploy to production:</strong> See SERVER_DEPLOYMENT.md in the project repo</li>
        </ol>
      </section>
    </main>

    <footer>
      <p>CSV Dataset Explorer ‚Ä¢ Lightweight ‚Ä¢ Accessible ‚Ä¢ Zero Dependencies</p>
      <p class="text-muted small-text mt-1">
        Built with vanilla JavaScript, IndexedDB, and Express.js
      </p>
    </footer>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const basePath = window.location.pathname.includes('/openapi-reference') ? '/openapi-reference' : '';
      const proxyUrl = window.location.origin + basePath;
      
      // Minified bookmarklet code
      const bookmarkletCode = `javascript:(function(){const PROXY_URL="${proxyUrl}";(async()=>{function getHealthcareDatasetId(){const m=window.location.pathname.match(/dataset\\/([a-z0-9\\-]+)/i);return m?m[1]:null}function findCsvUrls(){const links=[...document.querySelectorAll('a[href*=".csv"]')].map(a=>a.href);const scripts=[...document.scripts].map(s=>s.textContent).join(' ');const csvMatches=scripts.match(/https?:[^\\s"'<>]+\\.csv/gi)||[];return[...new Set([...links,...csvMatches])]}const hId=getHealthcareDatasetId();if(hId){return void(window.location.href=PROXY_URL+'/demo/?dataset='+hId+'&domain=healthcare.gov')}const csvUrls=findCsvUrls();if(csvUrls.length===1){return void(window.location.href=PROXY_URL+'/demo/?url='+encodeURIComponent(csvUrls[0]))}if(csvUrls.length>1){const selected=prompt('Multiple CSVs found. Paste one URL or select first:\\n'+csvUrls.slice(0,5).join('\\n'));return void(window.location.href=PROXY_URL+'/demo/?url='+encodeURIComponent(selected||csvUrls[0]))}const manualUrl=prompt('No CSVs found. Paste a CSV URL:');manualUrl&&(window.location.href=PROXY_URL+'/demo/?url='+encodeURIComponent(manualUrl))})()})();`;

      // Draggable link
      document.getElementById('bookmarklet-link').innerHTML = `
        <a href="${bookmarkletCode}" class="pill-link large-pill">üìä CSV Explorer</a>
      `;

      // Minified code for manual installation
      const escapedCode = bookmarkletCode.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/'/g, '&#39;');
      document.getElementById('bookmarklet-code-display').innerHTML = `
        <div class="bookmarklet-code" tabindex="0" role="region" aria-label="Bookmarklet code">${escapedCode}</div>
        <button type="button" onclick="navigator.clipboard.writeText(\`${bookmarkletCode.replace(/`/g, '\\`')}\`)
          .then(() => alert('‚úì Copied to clipboard!'))
          .catch(() => alert('Failed to copy'))" 
          class="btn-ghost secondary mt-075">
          üìã Copy Code
        </button>
      `;

      const demoLink = document.getElementById('demo-link');
      if (demoLink) demoLink.href = `${basePath}/demo/`;
    });
  </script>
</body>
</html>
